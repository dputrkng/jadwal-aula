<!DOCTYPE html>
<html>
<head>
    <title>Form Jadwal Pemakaian Ruangan</title>
    <!-- Firebase App (the core Firebase SDK) -->
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <!-- Firebase Firestore -->
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>
</head>
<body>
    <h2>Form Jadwal Pemakaian Ruangan</h2>
    <form id="bookingForm">
        <label for="room">Ruangan:</label>
        <select id="room" name="room" required>
            <option value="Ruang A">Ruang A</option>
            <option value="Ruang B">Ruang B</option>
            <option value="Ruang C">Ruang C</option>
        </select>
        <br><br>

        <label for="date">Tanggal:</label>
        <input type="date" id="date" name="date" required>
        <br><br>

        <label for="startTime">Waktu Mulai:</label>
        <input type="time" id="startTime" name="startTime" required>
        <br><br>

        <label for="endTime">Waktu Selesai:</label>
        <input type="time" id="endTime" name="endTime" required>
        <br><br>

        <label for="purpose">Keperluan:</label>
        <input type="text" id="purpose" name="purpose" required>
        <br><br>

        <button type="submit">Pesan Ruangan</button>
    </form>

    <h3>Jadwal Pemakaian Ruangan</h3>
    <div id="schedule"></div>

    <script>
        // Konfigurasi Firebase (ganti dengan konfigurasi Anda sendiri)
        const firebaseConfig = {
            apiKey: "AIzaSyAgRYNgH-3HsnFVuJXAz5AbiBsU-Xe8o2g",
            authDomain: "jadwal-aula.firebaseapp.com",
            projectId: "jadwal-aula",
            storageBucket: "jadwal-aula.appspot.com",
            messagingSenderId: "1075933905095",
            appId: "1:1075933905095:web:c2836158c7d750516ebee2"
        };

        // Inisialisasi Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const form = document.getElementById('bookingForm');
        const scheduleDiv = document.getElementById('schedule');

        form.addEventListener('submit', function(event) {
            event.preventDefault();

            const room = form.room.value;
            const date = form.date.value;
            const startTime = form.startTime.value;
            const endTime = form.endTime.value;
            const purpose = form.purpose.value;

            // Debugging: Log data form submission
            console.log('Form submitted:', { room, date, startTime, endTime, purpose });

            // Cek bentrok jadwal
            db.collection('bookings')
                .where('room', '==', room)
                .where('date', '==', date)
                .get()
                .then(querySnapshot => {
                    let isConflict = false;
                    querySnapshot.forEach(doc => {
                        const booking = doc.data();
                        if ((startTime >= booking.startTime && startTime < booking.endTime) ||
                            (endTime > booking.startTime && endTime <= booking.endTime) ||
                            (startTime <= booking.startTime && endTime >= booking.endTime)) {
                            isConflict = true;
                        }
                    });

                    if (isConflict) {
                        alert('Ruangan sudah terpakai pada waktu tersebut!');
                    } else {
                        // Simpan pemesanan ke Firestore
                        db.collection('bookings').add({
                            room, date, startTime, endTime, purpose
                        }).then(() => {
                            form.reset();
                            updateSchedule();
                        });
                    }
                });
        });

        function updateSchedule() {
            scheduleDiv.innerHTML = '';
            db.collection('bookings').get().then(querySnapshot => {
                querySnapshot.forEach(doc => {
                    const booking = doc.data();
                    const bookingElement = document.createElement('div');
                    bookingElement.textContent = `${booking.date} - ${booking.room} - ${booking.startTime} hingga ${booking.endTime} - ${booking.purpose}`;
                    scheduleDiv.appendChild(bookingElement);
                });
            });
        }

        // Initial call to display bookings
        updateSchedule();

        // Debugging: Verify Firebase initialization
        console.log('Firebase initialized:', firebaseConfig);
    </script>
</body>
</html>
